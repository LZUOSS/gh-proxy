# GitHub Reverse Proxy Configuration
# This is the production configuration file with sensible defaults

# Server configuration
server:
  http_port: 8080
  https_port: 8443
  enable_https: false
  # tls_cert_file: /path/to/cert.pem
  # tls_key_file: /path/to/key.pem
  base_path: ""  # Base path for all routes (e.g., "/ghproxy" for xxxx.com/ghproxy/...)
  read_timeout: 30s
  write_timeout: 300s
  idle_timeout: 120s
  max_header_bytes: 1048576  # 1MB
  shutdown_timeout: 30s
  enable_graceful_shutdown: true

# Proxy configuration for upstream connections to GitHub
proxy:
  enabled: false
  type: socks5  # Options: "socks5", "http", "https"
  address: 127.0.0.1:1080
  # username: ""         # Optional: proxy authentication username
  # password: ""         # Optional: proxy authentication password
  timeout: 30s
  dial_timeout: 10s
  keep_alive: 30s
  max_idle_conns: 100
  max_idle_conns_per_host: 10
  idle_conn_timeout: 90s

# Cache configuration
cache:
  enabled: true
  type: hybrid  # Options: "memory", "disk", "hybrid"
  max_memory_size: 104857600    # 100MB - total memory cache size
  max_memory_entries: 1000      # Maximum number of entries in memory cache (overrides max_memory_size if set)
  max_disk_size: 10737418240    # 10GB
  disk_path: /var/cache/github-proxy
  ttl: 1h
  cleanup_interval: 5m
  enable_compression: true

# Rate limiting configuration
ratelimit:
  enabled: true
  requests_per_second: 100
  burst: 200
  strategy: ip  # Options: "ip", "token", "both"
  cleanup_interval: 1m
  ban_duration: 1h
  ban_threshold: 1000

# Authentication configuration
auth:
  enabled: false
  type: token  # Options: "token", "basic", "both"
  # tokens:
  #   - "your-secret-token-1"
  #   - "your-secret-token-2"
  token_header: X-Auth-Token
  allow_anonymous: true
  # require_auth:
  #   - /api/*
  #   - /admin/*

# Security configuration
security:
  enable_ssrf_protection: true
  allowed_domains:
    - github.com
    - raw.githubusercontent.com
    - api.github.com
    - codeload.github.com
    - gist.github.com
  # blocked_ips:
  #   - 192.168.1.1
  block_private_ips: true
  max_request_size: 104857600  # 100MB
  enable_cors: true
  cors_allowed_origins:
    - "*"
  enable_hsts: false
  hsts_max_age: 31536000  # 1 year
  enable_csp: false
  # csp_directives: "default-src 'self'"

# Metrics configuration
metrics:
  enabled: true
  port: 9090
  path: /metrics
  namespace: github_proxy

# Logging configuration
logging:
  level: info  # Options: "debug", "info", "warn", "error"
  format: json  # Options: "json", "text"
  output: stdout  # Options: "stdout", "file"
  # file_path: /var/log/github-proxy/app.log
  max_size: 100  # megabytes
  max_backups: 3
  max_age: 28  # days
  compress: true
